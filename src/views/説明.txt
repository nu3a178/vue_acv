予定データの形式

データベース(DynamoDB)には、月ごとに一日の午前・午後の予定が数値化されて一つの文字列として格納されています。

例：2023年1月の予定は、「#202301」の項目に格納されています。

この項目の中には、ユーザの予定が
「111133332222000011112222......」というように格納されています。
この一桁一桁の数値が、それぞれの予定のステータスに対応しています。
数値の意味は、以下の通りです。
0:"-"（未入力）
1:"出社"
2:"在宅"
3:"休暇"

メイン画面にアクセスした時点で、DynamoDBの中身をすべて取得し、
参照しやすいようにオブジェクト型に成形したうえで、一人ずつvalFromDB配列に格納しています。

＊＊＊＊＊
valFromDBは、オブジェクト配列です。
以下のキー・プロパティ群が、ユーザ一人ごとに定義されています。

【オブジェクトの構成】
ID:ユーザID（社員番号）
name:ユーザ名
team:チーム名
schedule_showing:{20230101:[0,0],20230102:[1,1],20230103:[2,2],...（詳細は後述）}
schedule_calender:カレンダー画面用予定パラメータ文字列。カレンダー入力画面に遷移する際、これを渡す。
comment_showing:コメント
comment_calender
kansai_showing
kansai_calender
attendStat:出社状態。(True/False)

例えば、データベースに100人の予定が登録されている場合、
ページの読み込み時にvalFromDB配列内に上記オブジェクトが100個作成されることになります。

【schedule_showingについて】

schedule_showingもオブジェクト型です。
mainViewで年末年始、月末月初のつなぎ目をスムーズにするため、日付をキー値に振って一日単位で予定を格納しています。

例:2022年12月～2023年2月までの3か月間の予定が登録されている場合

"20221201":[0,0], "20221202":[1,1], .... "20230228":[3,3]

キー値となる8桁の数字は、getDateKeyメソッドを呼び出すことで取得できます。

【getDateKey(m)】
getDateKeyを呼び出すと、ローカル変数のstandardDate（現在の日付で初期化したDateオブジェクト）
を年月日の8桁に成形してString文字列として返却します。

引数のmはint数値であり、これを指定するとstandardDateからm日後の日付を8桁の数値として返却します。

例：2023年1月31日の場合
standardDate:（2023年1月31日を表す）

getDateKey(0) を呼びだすと、"20230131"の文字列が返却される
getDateKey(2) を呼び出すと、"20230202"の文字列が返却される

【実際の予定表示方法】
getKeyStatusメソッドを使用しています。
getKeyStatusメソッド内で、上記getDateKeyメソッドの呼び出しや、パラメータの読み替えなどを行い、
「出社」「在宅」「休暇」「-」の文字列に変換して表示されます。

getKeyStatusメソッド(m,n,x)


mはvalFromDB配列のindex値です。
nは、getDateKeyメソッドの引数に使います。

xが0だと午前、1だと午後のステータスを読み取ります。


例：standardDateが2023年1月1日のときに「getKeyStatus(5,2,0)」と記述すると、
valFromDBのうち、6番目のユーザオブジェクトの「month_val」から、
standardDateから2日後→20230103の項目名を取得し、
午前の予定ステータスを文字列に読み替えます。